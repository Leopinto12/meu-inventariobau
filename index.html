<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIS√ÉO PRO v2.0</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background: #f8fafc; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        .sidebar-btn.active { background: #2563eb; color: white; transform: scale(1.05); }
        input, button { transition: all 0.2s ease; }
        @media (max-width: 768px) {
            .nav-bottom { position: fixed; bottom: 0; left: 0; width: 100%; display: flex; background: white; border-top: 1px solid #e2e8f0; z-index: 100; height: 75px; padding-bottom: env(safe-area-inset-bottom); }
            .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; font-weight: 800; color: #64748b; }
            main { padding-bottom: 100px; }
        }
    </style>
</head>
<body class="text-slate-900">

    <div id="login-page" class="fixed inset-0 z-[200] flex items-center justify-center bg-slate-900 px-6">
        <div class="bg-white p-10 rounded-[40px] shadow-2xl w-full max-w-sm text-center">
            <h1 class="text-3xl font-black italic mb-8 tracking-tighter text-blue-600">VIS√ÉO PRO</h1>
            <input type="password" id="pass" placeholder="Senha" class="w-full p-5 bg-slate-100 rounded-2xl mb-4 outline-none focus:ring-2 focus:ring-blue-500 font-bold text-center">
            <button onclick="handleLogin()" class="w-full bg-blue-600 text-white p-5 rounded-2xl font-black shadow-lg shadow-blue-500/30">ENTRAR</button>
        </div>
    </div>

    <div id="app-page" class="hidden min-h-screen flex flex-col md:flex-row">
        
        <nav class="nav-bottom md:w-64 md:flex-col md:static md:h-screen md:p-4 md:border-r">
            <div class="hidden md:block p-6 font-black italic text-2xl text-blue-600">VIS√ÉO</div>
            <button onclick="showTab('tab-files', this)" class="nav-item sidebar-btn active md:mb-2 md:rounded-2xl md:p-4">üìÅ<span>Arquivos</span></button>
            <button onclick="showTab('tab-finance', this)" class="nav-item sidebar-btn md:mb-2 md:rounded-2xl md:p-4">üí∞<span>Dinheiro</span></button>
            <button onclick="showTab('tab-goals', this)" class="nav-item sidebar-btn md:mb-2 md:rounded-2xl md:p-4">üìà<span>Metas</span></button>
            <button onclick="showTab('tab-notes', this)" class="nav-item sidebar-btn md:mb-2 md:rounded-2xl md:p-4">üìù<span>Notas</span></button>
        </nav>

        <main class="flex-1 p-5 md:p-10 max-w-5xl mx-auto w-full">
            
            <header class="flex justify-between items-center mb-8">
                <div>
                    <h2 id="tab-title" class="text-3xl font-black italic uppercase tracking-tighter">Arquivos</h2>
                    <p id="current-date-display" class="text-xs font-bold text-slate-400 uppercase"></p>
                </div>
                <input type="date" id="global-filter" onchange="renderAll()" class="bg-white border rounded-xl p-2 text-xs font-bold shadow-sm outline-none">
            </header>

            <section id="tab-files" class="tab-content active">
                <div class="bg-blue-600 p-8 rounded-[40px] text-white shadow-xl shadow-blue-200 mb-8 relative overflow-hidden">
                    <h3 class="font-bold opacity-80 mb-1">Armazenamento Nuvem</h3>
                    <p class="text-sm font-medium mb-6">Seus documentos protegidos.</p>
                    <button onclick="document.getElementById('up').click()" class="bg-white text-blue-600 px-8 py-3 rounded-2xl font-black text-sm shadow-lg">+ NOVO UPLOAD</button>
                    <input type="file" id="up" class="hidden" onchange="uploadFile(event)">
                </div>
                <div id="file-list" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
            </section>

            <section id="tab-finance" class="tab-content">
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-white p-6 rounded-[35px] shadow-sm border border-slate-100">
                        <p class="text-[10px] font-black text-slate-400 mb-1 uppercase">Saldo M√™s</p>
                        <h4 id="resumo-saldo" class="text-xl font-black text-green-600">R$ 0,00</h4>
                    </div>
                    <div class="bg-white p-6 rounded-[35px] shadow-sm border border-slate-100">
                        <p class="text-[10px] font-black text-slate-400 mb-1 uppercase">Total Gastos</p>
                        <h4 id="resumo-gastos" class="text-xl font-black text-red-500">R$ 0,00</h4>
                    </div>
                </div>
                <div class="flex gap-2 mb-6">
                    <button onclick="addFinance('entrada')" class="flex-1 bg-green-500 text-white p-4 rounded-2xl font-black text-xs shadow-lg shadow-green-100">+ ENTRADA</button>
                    <button onclick="addFinance('saida')" class="flex-1 bg-red-500 text-white p-4 rounded-2xl font-black text-xs shadow-lg shadow-red-100">+ GASTO/CART√ÉO</button>
                </div>
                <div id="finance-list" class="space-y-3"></div>
            </section>

            <section id="tab-goals" class="tab-content">
                <div id="goal-card" class="bg-white p-10 rounded-[50px] border shadow-sm text-center mb-6">
                    <p id="goal-name" class="font-black text-slate-400 text-xs uppercase tracking-widest mb-2">Sem objetivo</p>
                    <h3 id="goal-current" class="text-4xl font-black mb-6">R$ 0,00</h3>
                    <div class="w-full bg-slate-100 h-6 rounded-full overflow-hidden mb-4 p-1">
                        <div id="goal-bar" class="bg-blue-600 h-full rounded-full transition-all duration-1000 shadow-inner" style="width: 0%"></div>
                    </div>
                    <p id="goal-perc" class="text-blue-600 font-black">0% Conclu√≠do</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="addInvest()" class="flex-1 bg-slate-900 text-white p-5 rounded-3xl font-black">APORTAR</button>
                    <button onclick="setGoal()" class="bg-slate-200 text-slate-600 p-5 rounded-3xl font-black">‚öôÔ∏è</button>
                </div>
            </section>

            <section id="tab-notes" class="tab-content">
                <button onclick="addNote()" class="w-full bg-white border-2 border-dashed border-slate-300 p-6 rounded-[35px] text-slate-400 font-bold mb-6 hover:border-blue-500 hover:text-blue-500">+ Escrever nova nota...</button>
                <div id="notes-list" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
            </section>

        </main>
    </div>

    <script>
        // CONFIGURA√á√ÉO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyCdxLMjKdBN_1uIDk4YXfDIlRbNchndM5s",
            authDomain: "inventario-visao.firebaseapp.com",
            projectId: "inventario-visao",
            storageBucket: "inventario-visao.firebasestorage.app",
            messagingSenderId: "828286373134",
            appId: "1:828286373134:web:9bafa5872cdf124bfddb5f"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        let store = { files: [], finance: [], notes: [], goal: null };

        // DATA ATUAL
        const hoje = new Date().toLocaleDateString('pt-BR');
        document.getElementById('current-date-display').innerText = hoje;

        // LOGIN
        function handleLogin() {
            if(document.getElementById('pass').value === "lnventario2026") {
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('app-page').classList.remove('hidden');
                init();
            } else { alert("Senha incorreta"); }
        }

        // NAVEGA√á√ÉO
        function showTab(id, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.sidebar-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('tab-title').innerText = btn.innerText.replace(/[^\w\s]/gi, '');
        }

        // INICIALIZA√á√ÉO
        function init() {
            db.collection("arquivos").orderBy("createdAt", "desc").onSnapshot(s => { store.files = s.docs.map(d => ({id: d.id, ...d.data()})); renderFiles(); });
            db.collection("financeiro").orderBy("createdAt", "desc").onSnapshot(s => { store.finance = s.docs.map(d => ({id: d.id, ...d.data()})); renderFinance(); });
            db.collection("notas").orderBy("createdAt", "desc").onSnapshot(s => { store.notes = s.docs.map(d => ({id: d.id, ...d.data()})); renderNotes(); });
            db.collection("metas").doc("principal").onSnapshot(d => { store.goal = d.data(); renderGoal(); });
        }

        function renderAll() { renderFiles(); renderFinance(); renderNotes(); }

        // M√ìDULO: ARQUIVOS
        async function uploadFile(e) {
            const file = e.target.files[0];
            if(!file) return;
            const path = `arquivos/${Date.now()}_${file.name}`;
            const ref = storage.ref(path);
            alert("Enviando...");
            await ref.put(file);
            const url = await ref.getDownloadURL();
            await db.collection("arquivos").add({ name: file.name, url, date: hoje, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
        }

        function renderFiles() {
            const filter = document.getElementById('global-filter').value;
            const dataF = filter ? new Date(filter).toLocaleDateString('pt-BR') : null;
            const list = document.getElementById('file-list');
            list.innerHTML = store.files.filter(f => !dataF || f.date === dataF).map(f => `
                <div class="bg-white p-5 rounded-[30px] shadow-sm flex justify-between items-center border border-slate-50">
                    <div class="truncate pr-4"><p class="font-black text-sm truncate">${f.name}</p><p class="text-[9px] text-slate-300 font-bold">${f.date}</p></div>
                    <div class="flex gap-2">
                        <a href="${f.url}" target="_blank" class="bg-blue-50 text-blue-600 p-3 rounded-2xl text-[10px] font-black">ABRIR</a>
                        <button onclick="deleteDoc('arquivos','${f.id}')" class="text-red-200 hover:text-red-500 px-2 font-bold">‚úï</button>
                    </div>
                </div>`).join('');
        }

        // M√ìDULO: FINANCEIRO
        async function addFinance(tipo) {
            const desc = prompt("Descri√ß√£o:");
            const valor = parseFloat(prompt("Valor (R$):"));
            if(!desc || isNaN(valor)) return;
            let parcelas = 1;
            if(tipo === 'saida') parcelas = parseInt(prompt("Parcelas (1 para √† vista):") || 1);
            
            await db.collection("financeiro").add({
                desc, valor, tipo, parcelas, 
                date: hoje, 
                mes: new Date().getMonth(), 
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        }

        function renderFinance() {
            let saldo = 0, gastos = 0;
            const mesAtual = new Date().getMonth();
            const list = document.getElementById('finance-list');
            
            list.innerHTML = store.finance.map(f => {
                const vParcela = f.valor / f.parcelas;
                if(f.mes === mesAtual) {
                    if(f.tipo === 'entrada') saldo += f.valor;
                    else gastos += vParcela;
                }
                return `
                <div class="bg-white p-5 rounded-[25px] shadow-sm flex justify-between items-center border border-slate-50">
                    <div><p class="font-black text-sm">${f.desc}</p><p class="text-[9px] font-bold text-slate-300 uppercase">${f.tipo} ${f.parcelas > 1 ? `(${f.parcelas}x)` : ''}</p></div>
                    <div class="text-right">
                        <p class="font-black ${f.tipo === 'entrada' ? 'text-green-500' : 'text-red-500'}">R$ ${vParcela.toFixed(2)}</p>
                        <button onclick="deleteDoc('financeiro','${f.id}')" class="text-[8px] font-bold text-slate-300">EXCLUIR</button>
                    </div>
                </div>`;
            }).join('');
            
            document.getElementById('resumo-saldo').innerText = `R$ ${(saldo - gastos).toFixed(2)}`;
            document.getElementById('resumo-gastos').innerText = `R$ ${gastos.toFixed(2)}`;
        }

        // M√ìDULO: METAS
        async function setGoal() {
            const nome = prompt("Nome do Objetivo:");
            const objetivo = parseFloat(prompt("Valor Final (R$):"));
            if(nome && objetivo) await db.collection("metas").doc("principal").set({ nome, objetivo, atual: 0 });
        }

        async function addInvest() {
            const v = parseFloat(prompt("Valor do Aporte (R$):"));
            if(!isNaN(v)) await db.collection("metas").doc("principal").update({ atual: firebase.firestore.FieldValue.increment(v) });
        }

        function renderGoal() {
            if(!store.goal) return;
            const perc = Math.min((store.goal.atual / store.goal.objetivo) * 100, 100).toFixed(1);
            document.getElementById('goal-name').innerText = store.goal.nome;
            document.getElementById('goal-current').innerText = `R$ ${store.goal.atual.toLocaleString('pt-BR')}`;
            document.getElementById('goal-bar').style.width = perc + "%";
            document.getElementById('goal-perc').innerText = perc + "% CONCLU√çDO";
        }

        // M√ìDULO: NOTAS
        async function addNote() {
            const text = prompt("Escreva sua nota:");
            if(text) await db.collection("notas").add({ text, date: hoje, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
        }

        function renderNotes() {
            const filter = document.getElementById('global-filter').value;
            const dataF = filter ? new Date(filter).toLocaleDateString('pt-BR') : null;
            const list = document.getElementById('notes-list');
            list.innerHTML = store.notes.filter(n => !dataF || n.date === dataF).map(n => `
                <div class="bg-white p-6 rounded-[35px] shadow-sm border border-slate-50 relative">
                    <p class="font-bold text-slate-600 leading-relaxed">${n.text}</p>
                    <div class="mt-4 flex justify-between items-center border-t pt-3">
                        <span class="text-[9px] font-black text-slate-300 uppercase">${n.date}</span>
                        <button onclick="deleteDoc('notas','${n.id}')" class="text-red-300 text-xs font-bold">APAGAR</button>
                    </div>
                </div>`).join('');
        }

        async function deleteDoc(col, id) {
            if(confirm("Deseja excluir permanentemente?")) await db.collection(col).doc(id).delete();
        }

    </script>
</body>
</html>

